---
layout: post
title: CoffeeDemo – A Simple Demo of IronJS, using CoffeeScript
date: 2011-06-29
---
<p>&nbsp;</p>  <blockquote>   <p><font style="background-color: #ffff00">Warning: the APIs used in this demo are subject to improvement in the future.&nbsp; This is just a demo to get your feet wet with the 0.2.0.1 release of IronJS.&nbsp; IronJS is still in the early stages, so your mileage may vary.</font></p> </blockquote>  <p>How would you like to have a CoffeeScript compiler, running 100% managed code?&nbsp; Well, I’ll leave out the foreplay and get right to it.</p>  <h4>Fire up an instance of Visual Studio, with NuGet installed.</h4>  <p>This is pretty self-explanatory, but just in case you don’t have NuGet installed, you can <a  href="http://docs.nuget.org/docs/start-here/installing-nuget">follow the directions on the NuGet website</a> to get started.</p>  <h4>Create a new Windows Application.</h4>  <p>Create a new Windows Application and name it ‘CoffeeDemo’.</p>  <h4>Use NuGet to install IronJS.</h4>  <p>For those of you experienced with NuGet, the command in the Package Manager Console is:</p>  <blockquote></blockquote>  <blockquote>   <p><font face="Consolas">Install-Package IronJS</font></p> </blockquote>  <p>If you prefer to use the GUI to add your package, you can <a  href="http://docs.nuget.org/docs/start-here/managing-nuget-packages-using-the-dialog">consult the GUI directions</a> provided at NuGet.org</p>  <h4>Lay-out your project and form.</h4>  <p>At a minimum, you should add the following to your form:</p>  <ol>   <li>An input textbox, for CoffeeScript.</li>    <li>An output textbox, for JavaScript.</li>    <li>A button, for executing the JavaScript.</li> </ol>  <p>You will want to make your text boxes Multiline, and large enough to enter some JavaScript source</p>  <p>Here is how mine looks:   <br><img title="CoffeeDemo - 1 - Layout" alt="CoffeeDemo - 1 - Layout" src="/images/posts/CoffeeDemo%20-%201%20-%20Layout.png" /></p>  <p>I decided to use a split panel (anchored to all four sides) to contain my text boxes.&nbsp; I set my text boxes to dock-fill and gave them both horizontal and vertical scroll bars.&nbsp; I also anchored my Execute button to the bottom right.&nbsp; Finally, I hate the name <font face="Consolas">Form1</font>, so I always rename my form to <strong><font face="Consolas">View</font></strong> or <font face="Consolas">MainView</font>.</p>  <p>Name your controls <font face="Consolas"><strong>CoffeeScriptBox</strong></font>, <font face="Consolas"><strong>JavaScriptBox</strong></font>, and <font face="Consolas"><strong>ExecuteButton</strong></font>.</p>  <h4>Create the IronJS context.</h4>  <p>In the code for our view, we need to create an IronJS context, to do all of the heavy lifting behind the scenes.&nbsp; We will do this with a function <strong><font face="Consolas">InitializeContext</font></strong>, called from the constructor:</p>  <blockquote>   <pre><span style="color: " class="keyword"><font color="#0000ff"><font face="Consolas" size="2">using</font></font></span><font face="Consolas" size="2">&nbsp;<span class="identifier">System</span>;<br><span style="color: " class="keyword"><font color="#0000ff">using</font></span>&nbsp;<span class="identifier">System</span><span class="operator">.</span><span class="identifier">Windows</span><span class="operator">.</span><span class="identifier">Forms</span>;<br><span style="color: " class="keyword"><font color="#0000ff">using</font></span>&nbsp;<span class="identifier">IronJS</span>;<br><span style="color: " class="keyword"><font color="#0000ff">using</font></span>&nbsp;<span class="identifier">IronJS</span><span class="operator">.</span><span class="identifier">Hosting</span>;<br><span style="color: " class="keyword"><font color="#0000ff">using</font></span>&nbsp;<span class="identifier">IronJS</span><span class="operator">.</span><span class="identifier">Native</span>;<br> <br><span style="color: " class="keyword"><font color="#0000ff">namespace</font></span>&nbsp;<span class="identifier">CoffeeDemo</span><br>{<br>&nbsp;&nbsp;&nbsp; <span style="color: " class="keyword"><font color="#0000ff">public</font></span>&nbsp;<span style="color: " class="keyword"><font color="#0000ff">partial</font></span>&nbsp;<span style="color: " class="keyword"><font color="#0000ff">class</font></span>&nbsp;<span style="color: " class="User Types"><font color="#2b91af">View</font></span> : <span style="color: " class="User Types"><font color="#2b91af">Form</font></span><br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: " class="keyword"><font color="#0000ff">private</font></span>&nbsp;<span style="color: " class="User Types"><font color="#2b91af">CSharp</font></span><span class="operator">.</span><span style="color: " class="User Types"><font color="#2b91af">Context</font></span>&nbsp;<span class="identifier">context</span>;<br> <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: " class="keyword"><font color="#0000ff">public</font></span>&nbsp;<span class="identifier">View</span>()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="identifier">InitializeContext</span>();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="identifier">InitializeComponent</span>();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br> <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: " class="keyword"><font color="#0000ff">private</font></span>&nbsp;<span style="color: " class="keyword"><font color="#0000ff">void</font></span>&nbsp;<span class="identifier">InitializeContext</span>()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: " class="User Types(Delegates)"><font color="#2b91af">Action</font></span><span class="operator">&lt;</span><span style="color: " class="keyword"><font color="#0000ff">string</font></span><span class="operator">&gt;</span>&nbsp;<span class="identifier">alert</span>&nbsp;<span class="operator">=</span>&nbsp;<span class="identifier">message</span>&nbsp;<span class="operator">=&gt;</span>&nbsp;<span style="color: " class="User Types"><font color="#2b91af">MessageBox</font></span><span class="operator">.</span><span class="identifier">Show</span>(<span class="identifier">message</span>);<br> <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: " class="keyword"><font color="#0000ff">this</font></span><span class="operator">.</span><span class="identifier">context</span>&nbsp;<span class="operator">=</span>&nbsp;<span style="color: " class="keyword"><font color="#0000ff">new</font></span>&nbsp;<span style="color: " class="User Types"><font color="#2b91af">CSharp</font></span><span class="operator">.</span><span style="color: " class="User Types"><font color="#2b91af">Context</font></span>();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: " class="keyword"><font color="#0000ff">this</font></span><span class="operator">.</span><span class="identifier">context</span><span class="operator">.</span><span class="identifier">SetGlobal</span>(<span style="color: " class="string"><font color="#a31515">"alert"</font></span>, <span style="color: " class="User Types"><font color="#2b91af">Utils</font></span><span class="operator">.</span><span class="identifier">CreateFunction</span>(<span style="color: " class="keyword"><font color="#0000ff">this</font></span><span class="operator">.</span><span class="identifier">context</span><span class="operator">.</span><span class="identifier">Environment</span>, <span class="number">1</span>, <span class="identifier">alert</span>));<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; }<br>}</font><br></pre>
</blockquote>

<p>Here, we can see the basics of creating a contexts, as well as exposing a CLR function to JavaScript.&nbsp; The alert function is now wired up to call directly into <font face="Consolas">MessageBox.Show</font>.</p>

<h4>Wire-up the execute button.</h4>

<p>Just wire up the Click even of the execute button to a function like thisk,:</p>

<blockquote>
  <pre><span style="color: " class="keyword"><font color="#0000ff"><font face="Consolas" size="2">private</font></font></span><font face="Consolas" size="2">&nbsp;<span style="color: " class="keyword"><font color="#0000ff">void</font></span>&nbsp;<span class="identifier">ExecuteButton_Click</span>(<span style="color: " class="keyword"><font color="#0000ff">object</font></span>&nbsp;<span class="identifier">sender</span>, <span style="color: " class="User Types"><font color="#2b91af">EventArgs</font></span>&nbsp;<span class="identifier">e</span>)<br>{<br>&nbsp;&nbsp;&nbsp; <span style="color: " class="keyword"><font color="#0000ff">try</font></span><br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: " class="keyword"><font color="#0000ff">this</font></span><span class="operator">.</span><span class="identifier">context</span><span class="operator">.</span><span class="identifier">Execute</span>(<span style="color: " class="keyword"><font color="#0000ff">this</font></span><span class="operator">.</span><span class="identifier">JavaScriptBox</span><span class="operator">.</span><span class="identifier">Text</span>);<br>&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; <span style="color: " class="keyword"><font color="#0000ff">catch</font></span> (<span class="identifier">IronJS</span><span class="operator">.</span><span style="color: " class="User Types"><font color="#2b91af">Error</font></span><span class="operator">.</span><span style="color: " class="User Types"><font color="#2b91af">Error</font></span>&nbsp;<span class="identifier">ex</span>)<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: " class="User Types"><font color="#2b91af">MessageBox</font></span><span class="operator">.</span><span class="identifier">Show</span>(<span class="identifier">ex</span><span class="operator">.</span><span class="identifier">ToString</span>(), <span style="color: " class="string"><font color="#a31515">"Error from IronJS"</font></span>);<br>&nbsp;&nbsp;&nbsp; }<br>}</font></pre>
</blockquote>

<p>You can run a test like this:
  <br><img title="CoffeeDemo - 2 - Hello World" alt="CoffeeDemo - 2 - Hello World" src="/images/posts/CoffeeDemo%20-%202%20-%20Hello%20World.png" /></p>

<h4>Automatically download CoffeeScript.</h4>

<p>There are a couple of different methods that we could use to bring CoffeeScript into our app.&nbsp; We could include it in the folder, we could add it as an assembly resource, etc.</p>

<p>My preference for this demo, however, is to download CoffeeScript to the /bin directory on the first run of the app.</p>

<blockquote>
  <pre><font face="Consolas">…<br></font><font size="2"><font face="Consolas"><span style="color: " class="keyword"><font color="#0000ff">using</font></span>&nbsp;<span class="identifier">System</span><span class="operator">.</span><span class="identifier">IO</span>;<br><span style="color: " class="keyword"><font color="#0000ff">using</font></span>&nbsp;<span class="identifier">System</span><span class="operator">.</span><span class="identifier">Net</span>;<br>…<br> <br><span style="color: " class="keyword"><font color="#0000ff">namespace</font></span>&nbsp;<span class="identifier">CoffeeDemo</span><br>{<br>&nbsp;&nbsp;&nbsp; <span style="color: " class="keyword"><font color="#0000ff">public</font></span>&nbsp;<span style="color: " class="keyword"><font color="#0000ff">partial</font></span>&nbsp;<span style="color: " class="keyword"><font color="#0000ff">class</font></span>&nbsp;<span style="color: " class="User Types"><font color="#2b91af">View</font></span> : <span style="color: " class="User Types"><font color="#2b91af">Form</font></span><br>&nbsp;&nbsp;&nbsp; {<br>        …<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: " class="keyword"><font color="#0000ff">public</font></span>&nbsp;<span class="identifier">View</span>()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </font><span class="identifier"><font face="Consolas">…<br></font></span></font><font face="Consolas" size="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="identifier">LoadCoffeeScript</span>();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br> <br>        …<br> <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: " class="keyword"><font color="#0000ff">private</font></span>&nbsp;<span style="color: " class="keyword"><font color="#0000ff">void</font></span>&nbsp;<span class="identifier">LoadCoffeeScript</span>()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: " class="keyword"><font color="#0000ff">if</font></span> (<span class="operator">!</span><span style="color: " class="User Types"><font color="#2b91af">File</font></span><span class="operator">.</span><span class="identifier">Exists</span>(<span style="color: " class="string"><font color="#a31515">"coffee-script.js"</font></span>))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: " class="keyword"><font color="#0000ff">var</font></span>&nbsp;<span class="identifier">client</span>&nbsp;<span class="operator">=</span>&nbsp;<span style="color: " class="keyword"><font color="#0000ff">new</font></span>&nbsp;<span style="color: " class="User Types"><font color="#2b91af">WebClient</font></span>();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="identifier">client</span><span class="operator">.</span><span class="identifier">DownloadFile</span>(<span style="color: " class="string"><font color="#a31515">"https://raw.github.com/jashkenas/coffee-script/master/extras/coffee-script.js"</font></span>, <span style="color: " class="string"><font color="#a31515">"coffee-script.js"</font></span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br> <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: " class="keyword"><font color="#0000ff">this</font></span><span class="operator">.</span><span class="identifier">context</span><span class="operator">.</span><span class="identifier">ExecuteFile</span>(<span style="color: " class="string"><font color="#a31515">"coffee-script.js"</font></span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; }<br>}</font></pre>
</blockquote>

<p>At this point CoffeeScript is ready to go, and can be tested in the JavaScript text box.&nbsp; We are loading it in the constructor, which could negatively impact the application start-up time.&nbsp; However, for this example, I’m not concentrating on performance.</p>

<p>Try this for an example:</p>

<blockquote>
  <p><font face="Consolas">alert(CoffeeScript.compile('a = (x) -&gt; x * x', { bare: true }));</font></p>
</blockquote>

<h4>Wire-up the TextChanged event for live updating.</h4>

<p>Add a field of type FunctionObject to the view’s class, and add this function as the TextChanged event on the CoffeeScript text box:</p>

<blockquote>
  <pre><font><font><font size="2"><font face="Consolas"><span style="color: " class="keyword"><font color="#0000ff">private</font></span> </font></font></font></font><font><font><font size="2"><font face="Consolas"><span class="operator"></span><span style="color: " class="User Types"><font color="#2b91af">FunctionObject</font></span><span class="operator"></span></font></font></font></font><font><font><font size="2"><font face="Consolas"> </font></font></font></font><font><font><font size="2"><font face="Consolas"><span class="operator"></span><span class="identifier">compile;<br>...</span></font></font></font></font><font><font><font size="2"><font face="Consolas"> <span style="color: " class="keyword"></span></font></font></font></font><br><font size="2"><font face="Consolas"><span style="color: " class="keyword"><font color="#0000ff">private</font></span>&nbsp;<span style="color: " class="keyword"><font color="#0000ff">void</font></span>&nbsp;<span class="identifier">CoffeeScriptBox_TextChanged</span>(<span style="color: " class="keyword"><font color="#0000ff">object</font></span>&nbsp;<span class="identifier">sender</span>, <span style="color: " class="User Types"><font color="#2b91af">EventArgs</font></span>&nbsp;<span class="identifier">e</span>)<br>{<br>&nbsp;&nbsp;&nbsp; <span style="color: " class="keyword"><font color="#0000ff">if</font></span> (<span style="color: " class="keyword"><font color="#0000ff">this</font></span><span class="operator">.</span><span class="identifier">compile</span>&nbsp;<span class="operator">==</span>&nbsp;<span style="color: " class="keyword"><font color="#0000ff">null</font></span>)<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: " class="keyword"><font color="#0000ff">this</font></span><span class="operator">.</span><span class="identifier">context</span><span class="operator">.</span><span class="identifier">Execute</span>(<span style="color: " class="string"><font color="#a31515">"var compile = function (src) { return CoffeeScript.compile(src, { bare: true }); };"</font></span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: " class="keyword"><font color="#0000ff">this</font></span><span class="operator">.</span><span class="identifier">compile</span>&nbsp;<span class="operator">=</span>&nbsp;<span style="color: " class="keyword"><font color="#0000ff">this</font></span><span class="operator">.</span><span class="identifier">context</span><span class="operator">.</span><span class="identifier">GetGlobalAs</span><span class="operator">&lt;</span><span style="color: " class="User Types"><font color="#2b91af">FunctionObject</font></span><span class="operator">&gt;</span>(<span style="color: " class="string"><font color="#a31515">"compile"</font></span>);<br>&nbsp;&nbsp;&nbsp; }<br> </font></font><font size="2"><font face="Consolas"><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">try</span>
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">var</span>&nbsp;boxedResult&nbsp;=&nbsp;<span style="color:blue;">this</span>.compile.Call(<span style="color:blue;">this</span>.context.Globals,&nbsp;<span style="color:blue;">this</span>.CoffeeScriptBox.Text);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">var</span>&nbsp;result&nbsp;=&nbsp;<span style="color:#2b91af;">TypeConverter</span>.ToString(boxedResult);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">this</span>.JavaScriptBox.Text&nbsp;=&nbsp;result.Replace(<span style="color:#a31515;">"\n"</span>,&nbsp;<span style="color:#a31515;">"\r\n"</span>);
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">catch</span>&nbsp;(IronJS.<span style="color:#2b91af;">Error</span>.<span style="color:#2b91af;">Error</span>)
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;}<br>}</font></font></pre>
</blockquote>

<p>This shows you how to call a JavaScript function from the CLR.</p>

<h4>CoffeeDemo in action!</h4>

<p><img title="CoffeeDemo - 3 - Epic Win!" alt="CoffeeDemo - 3 - Epic Win!" src="/images/posts/CoffeeDemo%20-%203%20-%20Epic%20Win%21.png" /></p>

<p>You should now have a working, live-updating CoffeeScript compiler.&nbsp; You will almost certainly notice the compilation lag on the first key-press where we are compiling the helper function, and calling the CoffeeScript compiler for the first time.&nbsp; The lag is due to IronJS pushing everything into an in-memory, dynamic assembly.&nbsp; Subsequent key-presses should be pretty quick, tho, and we are striving to make it faster.</p>

<h4>Stay tuned.</h4>

<p>We are actively working on better .NET integration so that you can use native .NET types, all without using wrapper functions.&nbsp; So, stay with us, and please <a  href="https://github.com/fholm/IronJS/commits/master">follow us on Github</a>!</p>
